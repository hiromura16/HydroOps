# /opt/hydro-ops/docker/telegraf/config/telegraf.conf
# Telegraf Configuration

#-------------------------------------------------------------------------------
# Global Agent Configuration
#-------------------------------------------------------------------------------
[agent]
  # Default data collection interval for all inputs
  interval = "10s"
  # Rounds collection interval to 'interval'
  round_interval = true

  # Default data write interval for all outputs.
  flush_interval = "10s"
  # Jitter ensures a balanced load on a Telegraf instance.
  flush_jitter = "2s"

  # Specifies the precision of the timestamp.
  # precision = "" # Default is nanoseconds

  # Specifies the hostname. If not set, Telegraf uses the OS hostname.
  # We set it via an environment variable for consistency.
  hostname = "${TELEGRAF_AGENT_HOSTNAME}"
  # Do not include the OS hostname in tags.
  omit_hostname = false

  # Collection jitter is used to jitter the collection by a random amount.
  # This is primarily useful for large deployments.
  collection_jitter = "0s"

  # Metric batch size and buffer limit.
  metric_batch_size = 1000
  metric_buffer_limit = 10000

  # Log file for Telegraf.
  # logfile = "" # Logs to stdout by default in Docker

  # Log level.
  # quiet = false
  # debug = false
  # logtarget = "file" # "stderr" or "file" or "eventlog" (Windows only)

#-------------------------------------------------------------------------------
# Output Plugins
#-------------------------------------------------------------------------------
[[outputs.influxdb_v2]]
  # The URLs of the InfluxDB V2 server to send metrics to.
  # Environment variables are used here, passed from docker-compose.yml
  urls = ["${INFLUX_URL}"]

  # Token for authentication.
  token = "${INFLUX_TOKEN}"

  # Organization is the name of the organization to write to.
  organization = "${INFLUX_ORG}"

  # Destination bucket to write into.
  bucket = "${INFLUX_BUCKET}"

  # Timeout for HTTP messages.
  # timeout = "5s"

  # Optional TLS Config for InfluxDB connection
  # tls_ca = "/etc/telegraf/ca.pem"
  # tls_cert = "/etc/telegraf/cert.pem"
  # tls_key = "/etc/telegraf/key.pem"
  # insecure_skip_verify = false
[[outputs.prometheus_client]]
  ## Address to listen on.
  listen = ":9273" # Prometheusがスクレイプするポート (prometheus.ymlのtargetsと合わせる)
  ## Path to publish the metrics on.
  path = "/metrics"
  ## Collectors to enable, valid entries are "gocollector" and "process".

  
#-------------------------------------------------------------------------------
# Input Plugins
#-------------------------------------------------------------------------------

# Read metrics about cpu usage
[[inputs.cpu]]
  ## Whether to report per-cpu stats or not
  percpu = true
  ## Whether to report total system cpu stats or not
  totalcpu = true
  ## If true, collect raw CPU time metrics.
  collect_cpu_time = false
  ## If true, compute and report the sum of all non-idle CPU states.
  report_active = true
  ## If true, Telegraf will grab also core_id and physical_id labels.
  ## Best used with  percpu = true.
  # core_tags = false


# Read metrics about memory usage
[[inputs.mem]]
  # no configuration


# Read metrics about disk usage by mount point
[[inputs.disk]]
  ## By default stats will be gathered for all mount points.
  ## Set mount_points will restrictthe stats to only the specified mount points.
  mount_points = ["/"] # Monitor root filesystem. Adjust if you have other important mounts inside the container or that you want to monitor from host via /host prefix
  ## Ignore mount points by filesystem type.
  ignore_fs = ["tmpfs", "devtmpfs", "devfs", "iso9660", "overlay", "aufs", "squashfs"]
  ## To use a specific mount prefix for host monitoring within a container:
  ## This requires mounting host directories like /proc, /sys into the container under /host.
  ## For example, if / is mounted at /host in the container, set this to /host.
  # mount_prefix = "/host" # We are using HOST_PROC, HOST_SYS for other plugins, this might not be needed if plugins handle it.


# Read metrics about disk IO by device
[[inputs.diskio]]


# Get system load, uptime, and number of users logged in
[[inputs.system]]
  # no configuration


# Read metrics about network interface usage
[[inputs.net]]
  ## By default, telegraf gathers stats from all interfaces, excluding loopback interfaces.
  ## Setting interfaces will tell Telegraf to gather stats from only the specified interfaces.
  # interfaces = ["eth0"] # Or let Telegraf auto-discover. Adjust to your host's primary network interface if needed.


# Read metrics about swap memory usage
[[inputs.swap]]
  # no configuration


[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"
  timeout = "5s"
  # コンテナ名に "telegraf" を含むものを除外
  container_name_exclude = ["telegraf"]
  perdevice_include = ["cpu", "blkio", "network"]
  total_include = []